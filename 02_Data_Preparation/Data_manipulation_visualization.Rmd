---
title: "Asset_Returns"
author: "Mandar"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup}
knitr::opts_chunk$set(cache = TRUE, cache.lazy = FALSE, warning = FALSE,
                      message = FALSE,echo = TRUE, dpi = 360, warning = FALSE,
                      fig.width = 10, fig.height = 8)

```


```{r}
# Prequisite libraries
library(tidyquant)
library(tidymodels)
library(tidyverse)
library(tidyfinance)
library(broom)
library(lubridate)

```

# Data manipulation:- Converting the daily data to returns (monthly returns)
```{r}
# reading the data
ishares_prices <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/ishares_prices.rds")
# Monthly Returns
ishare_rets <- ishares_prices |> 
  group_by(symbol) |> 
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period     = "monthly",
               col_rename = "returns") |> 
  ungroup() |> 
  # for making the data consistent with the dates
  mutate(date = rollback(date, roll_to_first = TRUE))

```

# Data Visualization
## Time series plot of the sectoral ETFS (iShares ETFs)

```{r}
# this gives mean returns for each sector ETF but it is not very clear
ishare_rets |> 
  group_by(symbol) |> 
  ggplot(aes(date,returns, colour = symbol)) +
  geom_line() + facet_wrap(~symbol, scales = "free",ncol =4) +
  scale_x_date(
        limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
        date_breaks = "3 years",
        date_labels = "%Y",
        expand = c(0,0)
    ) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  labs(
    title = "Sectoral ETFs Monthly Returns",
    subtitle = "Period:2004-2025",
    caption = "ishares ETFs",
    x = "",
    y = "" 
  ) +
  theme(
       plot.title.position = "plot",
        plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
        plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
        axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
        axis.text.y = element_text(face = "bold", color = "black"),
        axis.title = element_text(face = "bold", color = "black"),
        axis.line = element_line(color = "black", linewidth  = 1),
        panel.background = element_rect(fill = "grey", color = NA),
        plot.background = element_rect(fill = "grey", color = NA),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line(color = "lightgrey", linewidth  = 0.5),
        axis.line.y.right = element_line(color = "black", linewidth  = 1),
        axis.text.y.right = element_text(face = "bold", color = "black"),
        axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
       legend.position = "none"
        
    ) 

```



##Performance of individual sectoral ETFs(iShare ETFs) for the period 2004-2025


### IYW: Technology
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYW") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.2,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.2,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .1,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .1,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYW Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
  
```
### IDU Utilites 
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IDU") |> 
  ggplot(aes(date, returns)) + 
  # Financial Crisis rectangle
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694") +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "3 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) +
   scale_y_continuous(
    limits = c(-.130, .120),
    expand = c(0,0), 
    breaks = c(seq(-.130, .120, .05), .120), 
     labels = function(x) sprintf("%.1f%%", x * 100)
  ) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +

  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = 0.09,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = 0.09,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +

  labs(
    title = "IDU Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )

```
### IYF Financials
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYF") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line() +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "3 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) +
  scale_y_continuous(
    limits = c(-.3,.3),
    breaks = seq(-.3,.3,.05), 
    expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .25,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .25,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYF Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
###IYR: Real Estate
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYR") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694") +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "3 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) +
  scale_y_continuous(
    limits = c(-.3,.3),
    breaks = seq(-.3,.3,.05), 
    expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .25,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .25,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYR Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
###IYH: Healthcare
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYH") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694") +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "3 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) +
  scale_y_continuous(
    limits = c(-.15,.15),
    breaks = seq(-.15,.15,.05), 
    expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .1,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .1,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYH Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### IYZ: Communications

```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYZ") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "3 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) +
  scale_y_continuous(
    limits = c(-.15,.15),
    breaks = seq(-.15,.15,.05), 
    expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .1,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .1,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYZMonthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
###IYC: Consumer Discretionary
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYC") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.2,.2)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.2,.2,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .15,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .15,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYC Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### IYJ: Industrials
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYJ") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.25,.2)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.25,.2,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .15,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .15,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYJ Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### IYE: Energy

```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYE") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.4,.35)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.4,.35,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .25,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .25,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYE Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```

### IYK: Consumer Staples
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYK") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.2,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.2,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .1,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .1,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYK Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### IYM : Materials
```{r}
# Define recession dates
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

ishare_rets |> 
  filter(symbol == "IYM") |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.3,.25)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.3,.25,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .2,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .2,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "IYM Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "ishares ETF",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```



# Analysis :- From the above plots for all the 11 Sectoral ETFs for the time period 2004-2025 we can clearly see that Financial Crisis (2007-2009) and Covid (2020-2023) had -ve impact on the performace of all the ETFs. Therefore these two events are the anomaly or in other words extreme events.  


##S&P 500 sector indices performance over the same period


###S&P 500 Energy Sector
```{r}
#Step 1:- Data for S&P500 Energy Sector Index 
energy_sectors_prices <- tq_get("^GSPE", get = "stock.prices", from = "2004-01-01")

# Monthly returns
energy_rets <- energy_sectors_prices |> 
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period     = "monthly",
               col_rename = "returns") |> 
  # for making the data consistent with the dates
  mutate(date = rollback(date, roll_to_first = TRUE))
recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

energy_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.4,.30)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.4,.30,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .25,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .25,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Energy Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### S&P 500 Materials (Sector) (^SP500-15)
```{r}
#Step 1:- Accesing the Data for S&P500 Material Sector Index 
material_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-15")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

material_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.25,.20)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.25,.20,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .15,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .15,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Materials Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
###S&P 500 Industrials (Sector) (^SP500-20)
```{r}
#Step 1:- Accesing the Data for S&P500 Material Sector Index 
industrial_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-20")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

industrial_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.20,.20)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.20,.20,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .15,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .15,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Industrials Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
###S&P 500 Financials (Sector) (^SP500-40)
```{r}
financial_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-40")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

financial_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.30,.25)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.30,.25,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .20, # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .20,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Financials Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```

### S&P 500 Information Technology (^SP500-45)
```{r}
tech_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-45")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

tech_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.20,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.20,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .12,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .12,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Financials Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```
### S&P 500 Communication Services (^SP500-50)
```{r}
communi_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-50")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

communi_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.20,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.20,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .12,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .12,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Communication Services Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )
```

###S&P 500 Consumer Staples (Sector) (^SP500-30)
```{r}
con_staples_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-30")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

con_staples_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.15,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.15,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .12,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .12,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Consumer Staples Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )

```

###S&P 500 Health Care (Sector) (^SP500-35)
```{r}
health_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-35")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

health_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.15,.15)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.15,.15,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .12,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .12,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Health Care Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )


```

S&P 500 Real Estate (Sector) (^SP500-60)
```{r}
real_estate_rets <- readRDS("/Users/mandarphatak/Documents/GitHub/Asset_Pricing/00_Data/sp500_sector_rets.rds") |> filter(symbol == "^SP500-60")

recession_start <- as.Date("2007-12-01")
recession_end <- as.Date("2010-01-01")  # Extended to cover early 2010
covid_start <- as.Date("2020-02-01")
covid_end <- as.Date("2023-05-01")

real_estate_rets |> 
  ggplot(aes(date, returns)) + 
  geom_rect(aes(xmin = recession_start, xmax = recession_end, ymin = -Inf, ymax = Inf),
            fill = "red", alpha = 0.2) +  # Light shading for recession
  # COVID rectangle
  geom_rect(aes(xmin = covid_start, xmax = covid_end, ymin = -Inf, ymax = Inf),
            fill = "#89CFF0", alpha = 0.2) +  # Light shading for COVID
  
  geom_line(col = "#034694",linewidth = 0.7) +
  scale_x_date(
    limits = c(as.Date("2004-01-01"), as.Date("2025-02-01")),
    date_breaks = "2 years",
    date_labels = "%Y",
    expand = c(0,0)
  ) + coord_cartesian(ylim = c(-.35,.35)) +
  scale_y_continuous(
#     limits = c(-.3,.15),
   breaks = seq(-.35,.35,.05), 
     expand = c(0,0), 
    labels = function(x) sprintf("%.1f%%", x * 100)  # Format to 1 decimal place
) +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
  # Annotations positioned within plot range
  annotate("text",
           x = recession_start + (recession_end - recession_start)/2,  # Middle of financial crisis
           y = .25,  # Adjusted within y-limits
           label = "Great Recession\n(Financial Crisis)",
           color = "darkred",
           fontface = "bold",
           size = 3) +
  
  annotate("text",
           x = covid_start + (covid_end - covid_start)/2,  # Middle of COVID recession
           y = .25,  # Adjusted within y-limits
           label = "COVID",
           color = "black",
           fontface = "bold",
           size = 3) +
  labs(
    title = "S&P 500 Real Estate Monthly Returns",
    subtitle = "Period: 2004-2025",
    caption = "Source:-Yahoo Finance",
    x = "",
    y = ""
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(hjust = 0, face = "bold", colour = "black"),
    plot.subtitle = element_text(hjust = 0, face = "bold", colour = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1, face = "bold", color = "black"),
    axis.text.y = element_text(face = "bold", color = "black"),
    axis.title = element_text(face = "bold", color = "black"),
    axis.line = element_line(color = "black", linewidth = 1),
    panel.background = element_rect(fill = "grey", color = NA),
    plot.background = element_rect(fill = "grey", color = NA),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "lightgrey", linewidth = 0.5),
    axis.line.y.right = element_line(color = "black", linewidth = 1),
    axis.text.y.right = element_text(face = "bold", color = "black"),
    axis.title.y.right = element_text(face = "bold", color = "black", angle = 90),
    legend.position = "none"
  )


```


S&P 500 Consumer Discretionary (^SP500-25)
```{r}

```

S&P 500 Utilities (Sector)(^SP500-55)
```{r}

```






### Lets see how much investment 

```{r}
library(ggplot2)
library(dplyr)

# Calculate cumulative returns
plot_investment_growth <- function(data) {
  growth_data <- data |>
    mutate(
      cum_return = cumprod(1 + returns),  # Calculate cumulative returns
      investment_value = cum_return       # Assuming $1 initial investment
    )
  
  # Create the plot
  ggplot(growth_data, aes(x = date, y = investment_value)) +
    geom_line(color = "#2c3e50", size = 1) +
    
    labs(
      title = "Growth of $1 Investment in S&P 500 Technology Sector",
      x = "Date",
      y = "Investment Value ($)",
      caption = "Data source: Yahoo Finance"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(size = 14, face = "bold"),
      axis.title = element_text(size = 12),
      panel.grid.minor = element_blank()
    ) +
    scale_y_continuous(labels = scales::dollar_format()) +
    scale_x_date(date_breaks = "2 years", date_labels = "%Y")
}

# Generate the plot
 plot_investment_growth(tech_rets)
```
```{r}
plot_investment_growth <- function(data) {
  growth_data <- data |>
    mutate(
      cum_return = cumprod(1 + returns),  # Calculate cumulative returns
      investment_value = cum_return       # Assuming $1 initial investment
    )
  
  # Create the plot
  ggplot(growth_data, aes(x = date, y = investment_value)) +
    geom_line(color = "#2c3e50", size = 1) +
    labs(
      title = "Growth of $1 Investment in IYW ",
      x = "Date",
      y = "Investment Value ($)",
      caption = "Data source: Yahoo Finance"
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(size = 14, face = "bold"),
      axis.title = element_text(size = 12),
      panel.grid.minor = element_blank()
    ) +
    scale_y_continuous(labels = scales::dollar_format()) +
    scale_x_date(date_breaks = "2 years", date_labels = "%Y")
}

# Generate the plot
plot_investment_growth(ishare_rets |> filter(symbol == "IYW"))
```

# 

